(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[986],{4986:function(t,e,a){Promise.resolve().then(a.bind(a,7714))},7714:function(t,e,a){"use strict";a.d(e,{default:function(){return f}});var i=a(7437),n=a(2265),l=a(7648),s=a(9376),r=a(5237),o=a(3003);function d(t,e){return"string"!=typeof t?t:t.replace(/{{\s*([^}]+)\s*}}/g,(t,a)=>{let i=(0,o.M)(e,a.trim());return null==i?"":String(i)})}function c(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.Yk.screens.find(e=>e.id===t);if(!a)return"/";let i=a.route.replace(/:([A-Za-z0-9_]+)/g,(t,a)=>{var i;return null!==(i=e[a])&&void 0!==i?i:""});return"/".concat(i)}var u=a(2371);function p(t,e){return null==t||!t.roles||t.roles.includes(e)}function h(t,e){try{let{store:a,routeParams:i,router:n}=e;if("setState"===t.type){let i=t.path,n=d(t.value,e);a.setByPath(i,n)}if("navigate"===t.type){let a=Object.fromEntries(Object.entries(t.with||{}).map(t=>{let[a,i]=t;return[a,d(i,e)]})),i=c(t.to,a);n&&n.push(i)}if("conditionalNavigate"===t.type){let i=!!a.getByPath(t.if),l=Object.fromEntries(Object.entries(t.with||{}).map(t=>{let[a,i]=t;return[a,d(i,e)]}));n.push(c(i?t.to:t.elseTo,l))}if("selectAthleteByRouteParam"===t.type){let e=a.getByPath(t.from)||[],n=i[t.param],l=e.find(t=>t.id===n);l&&a.setByPath(t.target,l)}if("mutateMock"===t.type&&(t.valueBinding&&a.mutateMock(t.target,t.operation,a.getByPath(t.valueBinding)),t.valueTemplate)){let e=structuredClone(a.getByPath(t.valueTemplate));"note"===e.type&&(e.body="Went well: ".concat(a.getByPath("form.went_well")||"(from form)",". Hard: ").concat(a.getByPath("form.was_hard")||"(from form)",". Next: ").concat(a.getByPath("form.next_time")||"(from form)",".")),a.mutateMock(t.target,t.operation,e)}if("autoSyncStrava"===t.type){let t=a.getByPath("state.strava.hashtag")||"#sosg",e=(a.getByPath("mockData.stravaCandidates")||[]).filter(e=>e.tag===t);if(e.length>0&&a.getByPath("state.strava.accessTokenPresent")){let t=e.map(t=>({type:"session",source:"STRAVA",icon:"\uD83C\uDFC3",title:"Session",subtitle:"".concat(t.distanceKm," km • ").concat(t.movingMin," min • Effort: OK"),body:"Auto-imported from Strava (".concat(t.name,")."),date:t.date,id:"strava-".concat(t.id)}));a.mutateMock("mockData.selectedAthlete.timeline","prependMany",t),a.setByPath("state.strava.lastImportAt",new Date().toISOString())}}}catch(e){console.error("[runAction-error]",e,t)}}function m(t){var e;let{screenId:a,routeParams:o}=t,d=(0,n.useMemo)(()=>r.Yk.screens.find(t=>t.id===a),[a]),c=(0,s.useRouter)(),m=(0,u.q)();if((0,n.useEffect)(()=>{m.initPersistence()},[]),(0,n.useEffect)(()=>{!1===m.state.authed&&"login"!==a&&"register"!==a&&c.replace("/login")},[m.state.authed,a,c]),(0,n.useEffect)(()=>{var t;"athlete_detail"!==a||m.state.currentDetailTab||m.setByPath("state.currentDetailTab","feed"),null==d||null===(t=d.onEnter)||void 0===t||t.forEach(t=>h(t,{store:m,routeParams:o,route:o,router:c}))},[d,o,c]),(0,n.useEffect)(()=>{"athlete_list"===a&&0===m.mockData.filteredAthletes.length&&m.computeFilteredAthletes()},[a,m.mockData.filteredAthletes.length]),(0,n.useEffect)(()=>{"athlete_list"===a&&m.computeFilteredAthletes()},[m.state.athleteListSearch,m.state.athleteListSort,m.state.athleteListPage,a]),!d)return(0,i.jsxs)("div",{children:["Screen missing: ",a]});if(!p(d.visibility,m.state.role))return(0,i.jsxs)("div",{"data-testid":"screen-".concat(d.id),children:[(0,i.jsx)("p",{children:"Access denied"}),(0,i.jsx)(l.default,{href:"/athlete_list",children:"Go to athlete list"})]});let f={store:m,routeParams:o,route:o,state:m.state,data:null,router:c};return(0,i.jsxs)("div",{"data-testid":"screen-".concat(d.id),children:[(null===(e=d.layout)||void 0===e?void 0:e.type)!=="centered"&&(0,i.jsx)("h1",{children:d.title}),d.components.map(t=>p(t.visibility,m.state.role)?(0,i.jsx)(v,{component:t,ctx:f},t.id):null)]})}function v(t){var e,a,n,l,s,o,c,u,m,f,x,y,g,j,b,k,B,C,P,N,S,A,w,_,I,E;let{component:T,ctx:D,item:M,index:Y}=t,L=D.store,O=L.state.role;if(!p(T.visibility,O))return null;let F=function(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null!==(t=a.item)&&void 0!==t?t:M;e.forEach(t=>h(t,{...D,...a,item:i}))},R=T.id;if("conditionalRender"===T.type)return d(T.condition,{...D,item:M})?(0,i.jsx)(i.Fragment,{children:null===(u=T.components)||void 0===u?void 0:u.map(t=>(0,i.jsx)(v,{component:t,ctx:D,item:M},t.id))}):null;if("modalOverlay"===T.type){let t=T.onClose||[];return(0,i.jsx)("div",{className:"modal-overlay",children:(0,i.jsxs)("div",{className:"modal-content",style:{maxHeight:"80vh",overflow:"auto"},children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h3",{style:{margin:0,flex:1},children:null===(m=T.props)||void 0===m?void 0:m.title}),(0,i.jsx)("button",{className:"modal-close",onClick:()=>F(t),children:"✕"})]}),(0,i.jsx)("div",{style:{padding:"var(--space-4)"},children:null===(f=T.components)||void 0===f?void 0:f.map(t=>(0,i.jsx)(v,{component:t,ctx:D},t.id))})]})})}if("text"===T.type)return(0,i.jsx)("p",{children:d(null===(e=T.props)||void 0===e?void 0:e.text,{...D,item:M})});if("divider"===T.type)return(0,i.jsx)("hr",{});if("image"===T.type||"avatar"===T.type)return(0,i.jsx)("div",{className:"card",children:(null===(a=T.props)||void 0===a?void 0:a.alt)||"Avatar"});if("sectionTitle"===T.type)return(0,i.jsx)("h2",{children:null===(n=T.props)||void 0===n?void 0:n.text});if("searchBar"===T.type)return(0,i.jsx)("input",{"data-testid":"search-".concat(R),placeholder:null===(x=T.props)||void 0===x?void 0:x.placeholder,value:L.state.athleteListSearch||"",onChange:t=>{L.setByPath("state.athleteListSearch",t.target.value),L.setByPath("state.athleteListPage",0)}});if("header"===T.type)return(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("button",{onClick:()=>F([T.props.leftAction]),children:"Back"}),(0,i.jsx)("strong",{children:L.getByPath(T.props.titleBinding)}),(0,i.jsx)("button",{onClick:()=>F(T.actions),children:T.props.rightIcon})]});if("kvList"===T.type)return(0,i.jsx)("dl",{children:T.props.items.map(t=>{let e=d(t.v,{...D,data:D.data,item:M});return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("dt",{children:t.k}),(0,i.jsx)("dd",{children:e})]},t.k)})});if("toggle"===T.type)return(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{"data-testid":"toggle-".concat(R),type:"checkbox",defaultChecked:null===(l=T.props)||void 0===l?void 0:l.default}),null===(s=T.props)||void 0===s?void 0:s.label]});if("button"===T.type)return(0,i.jsx)("button",{"data-testid":"btn-".concat(R),onClick:()=>F(T.actions),children:null===(o=T.props)||void 0===o?void 0:o.label});if("link"===T.type)return(0,i.jsx)("a",{"data-testid":"link-".concat(R),onClick:()=>F(T.actions),style:{cursor:"pointer",color:"var(--accent)",textDecoration:"underline"},children:null===(c=T.props)||void 0===c?void 0:c.text});if(["textInput","passwordInput","numberInput","textArea","dateTimePicker","chipInput","emojiPicker"].includes(T.type)){let t="textArea"===T.type?"textarea":"input";return(0,i.jsxs)("label",{children:[null===(y=T.props)||void 0===y?void 0:y.label,(0,i.jsx)(t,{"data-testid":"input-".concat(R),type:"passwordInput"===T.type?"password":"numberInput"===T.type?"number":"dateTimePicker"===T.type?"datetime-local":"text",placeholder:null===(g=T.props)||void 0===g?void 0:g.placeholder,onChange:t=>L.setFormValue(R,t.target.value)})]})}if("select"===T.type){let t=(null===(j=T.props)||void 0===j?void 0:j.options)||[],e=t.length>0&&"object"==typeof t[0];return(0,i.jsxs)("label",{children:[null===(b=T.props)||void 0===b?void 0:b.label,(0,i.jsx)("select",{"data-testid":"select-".concat(R),defaultValue:null===(k=T.props)||void 0===k?void 0:k.default,onChange:t=>{let e=t.target.value;L.setFormValue(R,e),F(T.actions,{value:e})},children:e?t.map(t=>(0,i.jsx)("option",{value:t.value,children:t.label},t.value)):t.map(t=>(0,i.jsx)("option",{value:t,children:t},t))})]})}if("segmentedControl"===T.type){let t=(null===(B=T.props)||void 0===B?void 0:B.options)||[],e=t.length>0&&"object"==typeof t[0],a=(null===(C=T.props)||void 0===C?void 0:C.stateBinding)?L.getByPath(T.props.stateBinding):L.controls[R],n=null===(P=T.props)||void 0===P?void 0:P.default,l=a||n;return(null===(N=T.props)||void 0===N?void 0:N.isTabs)||(null===(S=T.id)||void 0===S?void 0:S.includes("tabs"))||(null===(A=T.id)||void 0===A?void 0:A.includes("detail_tabs"))?(0,i.jsx)("div",{className:"tab-container",children:e?t.map(t=>(0,i.jsx)("button",{type:"button",className:"tab-button ".concat(l===t.value?"active":""),onClick:()=>{L.setByPath(T.props.stateBinding||"",t.value),F(T.actions,{value:t.value})},children:t.label},t.value)):t.map(t=>(0,i.jsx)("button",{type:"button",className:"tab-button ".concat(l===t?"active":""),onClick:()=>{L.setByPath(T.props.stateBinding||"",t),F(T.actions,{value:t})},children:t},t))}):(0,i.jsx)("div",{className:"segmented-group",children:e?t.map(t=>(0,i.jsx)("button",{type:"button",className:"segmented-button ".concat(l===t.value?"active":""),onClick:()=>{L.setControl(R,t.value),L.setByPath(T.props.stateBinding||"",t.value),F(T.actions,{value:t.value})},children:t.label},t.value)):t.map(t=>(0,i.jsx)("button",{type:"button",className:"segmented-button ".concat(l===t?"active":""),onClick:()=>{L.setControl(R,t),L.setByPath(T.props.stateBinding||"",t),F(T.actions,{value:t})},children:t},t))})}if("card"===T.type){let t=T.dataBinding?L.getByPath(T.dataBinding):null;return(0,i.jsxs)("section",{className:"card","data-testid":"card-".concat(R),children:[(0,i.jsx)("h3",{children:null===(w=T.props)||void 0===w?void 0:w.title}),null===(_=T.components)||void 0===_?void 0:_.map(e=>(0,i.jsx)(v,{component:e,ctx:{...D,data:t}},e.id)),null===(I=T.footerActions)||void 0===I?void 0:I.map(t=>(0,i.jsx)(v,{component:t,ctx:D},t.id))]})}if("actionBar"===T.type)return(0,i.jsx)("div",{className:"card",children:T.components.map(t=>(0,i.jsx)(v,{component:t,ctx:D},t.id))});if("list"===T.type){let t=L.getByPath(T.dataBinding)||[];if(T.filterBinding){let e=T.filterBinding.controlId,a=L.controls[e]||L.getByPath("state.".concat(e))||T.filterBinding.default||"all",i=T.filterBinding.map[a];i&&"*"!==i&&(t=t.filter(t=>t.type===i))}return!t.length&&T.emptyState?(0,i.jsxs)("div",{"data-testid":"list-".concat(R),children:[(0,i.jsx)("strong",{children:T.emptyState.title}),(0,i.jsx)("p",{children:T.emptyState.message})]}):(0,i.jsx)("div",{"data-testid":"list-".concat(R),className:(null===(E=T.props)||void 0===E?void 0:E.className)||"",children:t.map((t,e)=>{var a,n;if((null===(a=T.props)||void 0===a?void 0:a.itemTemplate)==="athleteCard")return(0,i.jsxs)("button",{className:"card","data-testid":"athlete-card-".concat(t.id),onClick:()=>F(T.actions,{item:t}),children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"8px"},children:[(0,i.jsx)("strong",{children:d(r.Yk.templates.athleteCard.title,{...D,item:t})}),t.status&&(0,i.jsx)("span",{className:"badge-".concat(t.status),children:t.status})]}),(0,i.jsx)("span",{children:d(r.Yk.templates.athleteCard.subtitle,{...D,item:t})}),(0,i.jsx)("span",{style:{fontSize:"var(--text-meta)",color:"var(--text-secondary)"},children:d(r.Yk.templates.athleteCard.meta,{...D,item:t})})]},t.id);if((null===(n=T.props)||void 0===n?void 0:n.itemTemplate)==="timelineCard"){let a=r.Yk.templates.timelineCard,n=d(a.badge,{...D,item:t});return(0,i.jsxs)("article",{className:"card ".concat(a.className),"data-testid":"timeline-item-".concat(e),onClick:()=>F(T.actions,{item:t}),style:{cursor:"pointer"},children:[(0,i.jsx)("strong",{children:d(a.title,{...D,item:t})}),(0,i.jsx)("p",{children:d(a.subtitle,{...D,item:t})}),(0,i.jsx)("p",{children:d(a.body,{...D,item:t})}),n&&(0,i.jsx)("span",{className:"feed-item-badge feed-item-badge-strava-sync",children:n}),(0,i.jsx)("span",{style:{fontSize:"var(--text-meta)",color:"var(--text-secondary)"},children:d(a.rightContent,{...D,item:t})})]},t.id||e)}return(0,i.jsx)("article",{className:"card",children:(0,i.jsx)("strong",{children:d(r.Yk.templates.stravaCandidateCard.title,{...D,item:t})})},t.id)})})}return(0,i.jsxs)("div",{children:["Unsupported component ",T.type,Y]})}function f(t){var e;let{screenId:a,routeParams:n={}}=t;if(!r._q.ok)return(0,i.jsxs)("main",{className:"page",children:[(0,i.jsx)("h1",{children:"Spec validation error"}),(0,i.jsx)("pre",{children:r._q.errors.join("\n")})]});let l=r.Yk.screens.find(t=>t.id===a),s=(null==l?void 0:null===(e=l.layout)||void 0===e?void 0:e.type)==="centered";return(0,i.jsx)("div",{style:s?{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"}:void 0,children:(0,i.jsx)(m,{screenId:a,routeParams:n})})}}}]);