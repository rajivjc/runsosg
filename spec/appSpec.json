{
  "app": {
    "name": "SOSG Running Club Hub",
    "platform": "mobile_web_pwa",
    "design": {
      "layout": "mobile_first",
      "navigation": "bottom_tabs",
      "tone": "calm_supportive_non_competitive",
      "privacyDefault": "strict"
    },
    "roles": ["PARENT", "VOLUNTEER", "COACH", "ADMIN"]
  },
  "state": {
    "role": "VOLUNTEER",
    "authed": false,
    "linkedStrava": false,
    "strava": {
      "accessTokenPresent": false,
      "lastImportAt": null,
      "importRules": {
        "mode": "TAG",
        "tag": "#sosg",
        "timeWindowMinutes": 240
      }
    }
  },
  "routes": {
    "initial": "login",
    "tabs": [
      { "id": "tab_timeline", "label": "Timeline", "icon": "üèÉ", "route": "athlete_list" },
      { "id": "tab_athletes", "label": "Athletes", "icon": "üë•", "route": "athlete_list" },
      { "id": "tab_profile", "label": "Profile", "icon": "‚öôÔ∏è", "route": "profile" }
    ]
  },
  "screens": [
    {
      "id": "login",
      "title": "SOSG Running Club",
      "route": "login",
      "layout": { "type": "centered" },
      "components": [
        { "type": "image", "id": "logo", "props": { "alt": "SOSG Logo", "placeholder": true } },
        { "type": "textInput", "id": "email", "props": { "label": "Email", "placeholder": "name@example.com" } },
        { "type": "passwordInput", "id": "password", "props": { "label": "Password" } },
        {
          "type": "select",
          "id": "role_selector",
          "props": { "label": "Role (prototype)", "options": ["PARENT", "VOLUNTEER", "COACH", "ADMIN"], "default": "VOLUNTEER" },
          "actions": [{ "type": "setState", "path": "state.role", "value": "{{value}}" }]
        },
        {
          "type": "button",
          "id": "btn_login",
          "props": { "label": "Login" },
          "actions": [
            { "type": "setState", "path": "state.authed", "value": true },
            { "type": "navigate", "to": "athlete_list" }
          ]
        }
      ]
    },

    {
      "id": "athlete_list",
      "title": "Athletes",
      "route": "athlete_list",
      "layout": { "type": "list" },
      "components": [
        { "type": "searchBar", "id": "athlete_search", "props": { "placeholder": "Search athlete..." } },
        {
          "type": "list",
          "id": "athlete_cards",
          "props": { "itemTemplate": "athleteCard" },
          "dataBinding": "mockData.athletes",
          "actions": [{ "type": "navigate", "to": "athlete_timeline", "with": { "athleteId": "{{item.id}}" } }]
        }
      ]
    },

    {
      "id": "athlete_timeline",
      "title": "Athlete Timeline",
      "route": "athlete_timeline/:athleteId",
      "layout": { "type": "stack" },
      "onEnter": [
        { "type": "selectAthleteByRouteParam", "param": "athleteId", "from": "mockData.athletesFull", "target": "mockData.selectedAthlete" }
      ],
      "components": [
        {
          "type": "header",
          "id": "hdr_athlete",
          "props": {
            "leftAction": { "type": "navigate", "to": "athlete_list" },
            "titleBinding": "mockData.selectedAthlete.name",
            "rightIcon": "‚öôÔ∏è"
          },
          "actions": [{ "type": "navigate", "to": "athlete_settings", "with": { "athleteId": "{{route.athleteId}}" } }]
        },

        {
          "type": "card",
          "id": "card_cues_pinned",
          "props": { "title": "What works (pinned)", "collapsible": true, "defaultCollapsed": false },
          "dataBinding": "mockData.selectedAthlete.cues",
          "components": [
            { "type": "kvList", "id": "cues_list", "props": { "items": [
              { "k": "Helps", "v": "{{data.helps}}" },
              { "k": "Avoid", "v": "{{data.avoids}}" },
              { "k": "Best cues", "v": "{{data.bestCues}}" },
              { "k": "Kit", "v": "{{data.kit}}" }
            ]}}
          ],
          "footerActions": [
            {
              "type": "button",
              "id": "btn_edit_cues",
              "visibility": { "roles": ["VOLUNTEER", "COACH", "ADMIN"] },
              "props": { "label": "Edit cues" },
              "actions": [{ "type": "navigate", "to": "edit_cues", "with": { "athleteId": "{{route.athleteId}}" } }]
            }
          ]
        },

        { "type": "segmentedControl", "id": "timeline_filter", "props": { "options": ["All", "Sessions", "Notes", "Milestones", "Photos"], "default": "All" } },

        {
          "type": "list",
          "id": "timeline_feed",
          "props": { "itemTemplate": "timelineCard" },
          "dataBinding": "mockData.selectedAthlete.timeline",
          "filterBinding": { "controlId": "timeline_filter", "map": { "All": "*", "Sessions": "session", "Notes": "note", "Milestones": "milestone", "Photos": "photo" } },
          "emptyState": { "title": "No entries yet", "message": "Add a coach note or a first session to start the athlete‚Äôs journey." }
        },

        {
          "type": "actionBar",
          "id": "timeline_actions",
          "props": { "style": "sticky_bottom" },
          "components": [
            {
              "type": "button",
              "id": "btn_add_note",
              "visibility": { "roles": ["VOLUNTEER", "COACH", "ADMIN"] },
              "props": { "label": "Add Note" },
              "actions": [{ "type": "navigate", "to": "add_coach_note", "with": { "athleteId": "{{route.athleteId}}" } }]
            },
            {
              "type": "button",
              "id": "btn_add_session",
              "visibility": { "roles": ["VOLUNTEER", "COACH", "ADMIN"] },
              "props": { "label": "Add Session" },
              "actions": [{ "type": "navigate", "to": "add_session", "with": { "athleteId": "{{route.athleteId}}" } }]
            },
            {
              "type": "button",
              "id": "btn_import_strava",
              "visibility": { "roles": ["VOLUNTEER", "COACH", "ADMIN"] },
              "props": { "label": "Import Strava" },
              "actions": [
                { "type": "conditionalNavigate", "if": "state.strava.accessTokenPresent", "to": "strava_import_review", "elseTo": "strava_connect", "with": { "athleteId": "{{route.athleteId}}" } }
              ]
            }
          ]
        }
      ]
    },

    {
      "id": "athlete_settings",
      "title": "Athlete Settings",
      "route": "athlete_settings/:athleteId",
      "layout": { "type": "stack" },
      "components": [
        { "type": "sectionTitle", "id": "sec_privacy", "props": { "text": "Privacy & Consent" } },
        { "type": "toggle", "id": "consent_photos", "props": { "label": "Allow photos in timeline", "default": false } },
        { "type": "toggle", "id": "consent_location", "props": { "label": "Show route/maps to coaches", "default": false } },
        { "type": "divider", "id": "div1" },
        { "type": "sectionTitle", "id": "sec_strava", "props": { "text": "Strava" } },
        {
          "type": "button",
          "id": "btn_strava_connect",
          "props": { "label": "Connect Strava" },
          "actions": [{ "type": "navigate", "to": "strava_connect", "with": { "athleteId": "{{route.athleteId}}" } }]
        }
      ]
    },

    {
      "id": "strava_connect",
      "title": "Connect Strava",
      "route": "strava_connect/:athleteId",
      "layout": { "type": "stack" },
      "components": [
        { "type": "text", "id": "strava_info", "props": { "text": "Connect a Strava account to import runs. In production, this uses OAuth. In prototype, simulate connect." } },
        {
          "type": "button",
          "id": "btn_simulate_strava_connect",
          "props": { "label": "Simulate Strava Connect" },
          "actions": [
            { "type": "setState", "path": "state.strava.accessTokenPresent", "value": true },
            { "type": "toast", "message": "Strava connected (prototype)." },
            { "type": "navigate", "to": "strava_import_review", "with": { "athleteId": "{{route.athleteId}}" } }
          ]
        }
      ]
    },

    {
      "id": "strava_import_review",
      "title": "Import from Strava",
      "route": "strava_import_review/:athleteId",
      "layout": { "type": "stack" },
      "components": [
        { "type": "text", "id": "rules_title", "props": { "text": "Import rules (prototype)" } },
        {
          "type": "select",
          "id": "import_mode",
          "props": { "label": "Mode", "options": ["TAG", "TIME_WINDOW"], "default": "TAG" },
          "actions": [{ "type": "setState", "path": "state.strava.importRules.mode", "value": "{{value}}" }]
        },
        { "type": "textInput", "id": "tag", "props": { "label": "Tag (if TAG mode)", "placeholder": "#sosg" } },
        { "type": "numberInput", "id": "time_window", "props": { "label": "Time window minutes (if TIME_WINDOW)", "step": 15 } },
        { "type": "divider", "id": "div2" },
        {
          "type": "list",
          "id": "candidate_activities",
          "props": { "itemTemplate": "stravaCandidateCard" },
          "dataBinding": "mockData.stravaCandidates"
        },
        {
          "type": "button",
          "id": "btn_import_selected",
          "props": { "label": "Import selected" },
          "actions": [
            { "type": "mutateMock", "target": "mockData.selectedAthlete.timeline", "operation": "prependMany", "valueBinding": "mockData.stravaCandidatesSelectedAsTimelineEvents" },
            { "type": "setState", "path": "state.strava.lastImportAt", "value": "NOW" },
            { "type": "toast", "message": "Imported (prototype)." },
            { "type": "navigate", "to": "athlete_timeline", "with": { "athleteId": "{{route.athleteId}}" } }
          ]
        }
      ]
    },

    {
      "id": "add_coach_note",
      "title": "Add Coach Note",
      "route": "add_coach_note/:athleteId",
      "layout": { "type": "form" },
      "visibility": { "roles": ["VOLUNTEER", "COACH", "ADMIN"] },
      "components": [
        { "type": "emojiPicker", "id": "mood_before", "props": { "label": "Mood before" } },
        { "type": "emojiPicker", "id": "mood_after", "props": { "label": "Mood after" } },
        { "type": "textArea", "id": "went_well", "props": { "label": "What went well", "maxChars": 120 } },
        { "type": "textArea", "id": "was_hard", "props": { "label": "What was hard", "maxChars": 120 } },
        { "type": "textArea", "id": "next_time", "props": { "label": "Next time: do / avoid", "maxChars": 120 } },
        {
          "type": "button",
          "id": "btn_save_note",
          "props": { "label": "Save Note" },
          "actions": [
            { "type": "mutateMock", "target": "mockData.selectedAthlete.timeline", "operation": "prepend", "valueTemplate": "mockTemplates.newNote" },
            { "type": "navigate", "to": "athlete_timeline", "with": { "athleteId": "{{route.athleteId}}" } }
          ]
        }
      ]
    },

    {
      "id": "edit_cues",
      "title": "Edit What Works",
      "route": "edit_cues/:athleteId",
      "layout": { "type": "form" },
      "visibility": { "roles": ["VOLUNTEER", "COACH", "ADMIN"] },
      "components": [
        { "type": "chipInput", "id": "helps", "props": { "label": "Helps (add multiple)" } },
        { "type": "chipInput", "id": "avoids", "props": { "label": "Avoid (add multiple)" } },
        { "type": "chipInput", "id": "bestCues", "props": { "label": "Best cues (add multiple)" } },
        { "type": "chipInput", "id": "kit", "props": { "label": "Kit (add multiple)" } },
        {
          "type": "button",
          "id": "btn_save_cues",
          "props": { "label": "Save" },
          "actions": [
            { "type": "toast", "message": "Cues saved (prototype)." },
            { "type": "navigate", "to": "athlete_timeline", "with": { "athleteId": "{{route.athleteId}}" } }
          ]
        }
      ]
    },

    {
      "id": "add_session",
      "title": "Add Session",
      "route": "add_session/:athleteId",
      "layout": { "type": "form" },
      "visibility": { "roles": ["VOLUNTEER", "COACH", "ADMIN"] },
      "components": [
        { "type": "dateTimePicker", "id": "session_time", "props": { "label": "Date & time" } },
        { "type": "numberInput", "id": "distance_km", "props": { "label": "Distance (km)", "step": 0.1 } },
        { "type": "numberInput", "id": "moving_minutes", "props": { "label": "Moving time (min)", "step": 1 } },
        { "type": "select", "id": "effort", "props": { "label": "Effort", "options": ["Easy", "OK", "Hard"], "default": "OK" } },
        {
          "type": "button",
          "id": "btn_save_session",
          "props": { "label": "Save Session" },
          "actions": [
            { "type": "mutateMock", "target": "mockData.selectedAthlete.timeline", "operation": "prepend", "valueTemplate": "mockTemplates.newSessionManual" },
            { "type": "navigate", "to": "athlete_timeline", "with": { "athleteId": "{{route.athleteId}}" } }
          ]
        }
      ]
    },

    {
      "id": "profile",
      "title": "Profile",
      "route": "profile",
      "layout": { "type": "stack" },
      "components": [
        { "type": "avatar", "id": "user_avatar", "props": { "placeholder": true } },
        { "type": "kvList", "id": "user_info", "props": { "items": [
          { "k": "Name", "v": "Prototype User" },
          { "k": "Role", "v": "{{state.role}}" }
        ]}},
        {
          "type": "button",
          "id": "btn_logout",
          "props": { "label": "Logout" },
          "actions": [
            { "type": "setState", "path": "state.authed", "value": false },
            { "type": "navigate", "to": "login" }
          ]
        }
      ]
    }
  ],
  "templates": {
    "athleteCard": { "type": "card", "title": "{{item.name}}", "subtitle": "Latest: {{item.latestMilestone}}", "rightMeta": "{{item.lastSeen}}" },
    "timelineCard": { "type": "card", "title": "{{item.icon}} {{item.title}}", "subtitle": "{{item.subtitle}}", "body": "{{item.body}}", "meta": "{{item.date}}" },
    "stravaCandidateCard": { "type": "card", "title": "üèÉ {{item.name}}", "subtitle": "{{item.distanceKm}} km ‚Ä¢ {{item.movingMin}} min ‚Ä¢ {{item.date}}", "body": "Tag: {{item.tag}} ‚Ä¢ Source: Strava", "meta": "{{item.id}}" }
  },
  "mockData": {
    "athletes": [
      { "id": "a1", "name": "Daniel", "latestMilestone": "5 sessions completed", "lastSeen": "2 days ago" },
      { "id": "a2", "name": "Ayesha", "latestMilestone": "First continuous 1km", "lastSeen": "1 week ago" }
    ],
    "athletesFull": [
      {
        "id": "a1",
        "name": "Daniel",
        "cues": {
          "helps": "Countdown cues, run/walk 2/1, consistent route",
          "avoids": "Sudden loud noises, mid-run route changes",
          "bestCues": "‚Äú2 more lamp posts‚Äù, ‚Äústeady breathing‚Äù",
          "kit": "Water at 15 min, cap"
        },
        "timeline": [
          { "type": "session", "source": "STRAVA", "icon": "üèÉ", "title": "Session", "subtitle": "2.3 km ‚Ä¢ 24 min ‚Ä¢ Effort: OK", "body": "Imported from Strava (tag #sosg).", "date": "Sat 10:10" },
          { "type": "note", "icon": "üìù", "title": "Coach note", "subtitle": "Mood üòê ‚Üí üòä", "body": "Went well: steady pace. Hard: tired at 20 min. Next: water at 15.", "date": "Sat 10:35" },
          { "type": "milestone", "icon": "üéâ", "title": "Milestone", "subtitle": "5 sessions completed", "body": "Consistency win ‚Äî keep it going.", "date": "Sat 10:36" }
        ]
      },
      {
        "id": "a2",
        "name": "Ayesha",
        "cues": { "helps": "Short cues, predictable stops", "avoids": "Crowded paths", "bestCues": "‚ÄúOne more minute‚Äù", "kit": "Water, sunglasses" },
        "timeline": []
      }
    ],
    "selectedAthlete": {
      "id": "a1",
      "name": "Daniel",
      "cues": { "helps": "", "avoids": "", "bestCues": "", "kit": "" },
      "timeline": []
    },
    "stravaCandidates": [
      { "id": "s101", "name": "Morning Run", "distanceKm": 2.1, "movingMin": 22, "date": "Sun 09:15", "tag": "#sosg" },
      { "id": "s102", "name": "Park Jog", "distanceKm": 3.0, "movingMin": 31, "date": "Wed 18:40", "tag": "" }
    ],
    "stravaCandidatesSelectedAsTimelineEvents": [
      { "type": "session", "source": "STRAVA", "icon": "üèÉ", "title": "Session", "subtitle": "2.1 km ‚Ä¢ 22 min ‚Ä¢ Effort: OK", "body": "Imported from Strava.", "date": "Just now" }
    ]
  },
  "mockTemplates": {
    "newNote": { "type": "note", "icon": "üìù", "title": "Coach note", "subtitle": "Mood üòä ‚Üí üòä", "body": "Went well: (from form). Hard: (from form). Next: (from form).", "date": "Just now" },
    "newSessionManual": { "type": "session", "source": "MANUAL", "icon": "üèÉ", "title": "Session", "subtitle": "(from form) km ‚Ä¢ (from form) min ‚Ä¢ Effort: (from form)", "body": "Added manually.", "date": "Just now" }
  }
}
